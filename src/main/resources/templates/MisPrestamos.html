<!DOCTYPE html>

<html>
    <html xmlns:th="http://www.thymeleaf.org">
        <head>
            <title>Mis préstamos</title>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
                body {
                    font-family: Arial, sans-serif;
                    margin: 24px;
                    background: #f8f9fa;
                }
                header {
                    margin-bottom: 16px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                h1 {
                    margin: 0;
                }
                table {
                    border-collapse: collapse;
                    width: 100%;
                    margin-top: 12px;
                }
                th, td {
                    border: 1px solid #dcdcdc;
                    padding: 8px;
                }
                th {
                    background: #0d6efd;
                    color: white;
                    text-align: left;
                }
                button {
                    padding: 8px 12px;
                    background: #0d6efd;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }
                button:hover {
                    background: #0b5ed7;
                }
                .btn-secondary {
                    background: #6c757d;
                }
                .pill {
                    padding: 4px 8px;
                    border-radius: 12px;
                    color: white;
                    font-size: 12px;
                }
                .pill-prestado {
                    background: #198754;
                }
                .pill-pendiente {
                    background: #ffc107;
                    color: #212529;
                }
                .pill-devuelto {
                    background: #6c757d;
                }
                .mensaje {
                    margin: 12px 0;
                    padding: 12px;
                    background: #e7f5ff;
                    border: 1px solid #b6e0fe;
                    border-radius: 6px;
                    color: #084298;
                }
                .user-box {
                    font-size: 14px;
                    color: #495057;
                    text-align: right;
                }
                .user-box form {
                    display: inline-block;
                    margin-left: 8px;
                }
                .nav-buttons {
                    display: flex;
                    gap: 8px;
                    margin-bottom: 8px;
                }
            </style>
        </head>
        <body>
            <header>
                <div>
                    <h1>Mis préstamos</h1>
                    <p>Consulta tus reservas y solicita devoluciones.</p>
                    <div class="nav-buttons">
                        <a th:href="@{/prestamo/registrar}"><button type="button" class="btn-secondary">Registrar nuevo préstamo</button></a>
                    </div>
                </div>
                <div class="user-box">
                    <span th:text="${usuarioActivo} + ' (' + ${rolActivo} + ')'">Usuario lector</span>
                    <form th:action="@{/logout}" method="post">
                        <button type="submit">Cerrar sesión</button>
                    </form>
                </div>
            </header>

            <div th:if="${mensaje}" class="mensaje" th:text="${mensaje}"></div>

            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Libro</th>
                        <th>Lector</th>
                        <th>Fecha</th>
                        <th>Devolución</th>
                        <th>Estado</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="prestamo : ${prestamos}">
                        <td th:text="${prestamo.id}"></td>
                        <td th:text="${prestamo.tituloLibro}"></td>
                        <td th:text="${prestamo.lector}"></td>
                        <td th:text="${prestamo.fechaPrestamo}"></td>
                        <td th:text="${prestamo.fechaDevolucion}"></td>
                        <td>
                            <span th:classappend="${prestamo.estado.name() == 'PENDIENTE_APROBACION'} ? 'pill pill-pendiente' : ''"
                                  th:if="${prestamo.estado.name() == 'PENDIENTE_APROBACION'}">Pendiente de aprobación</span>
                            <span th:classappend="${prestamo.estado.name() == 'PRESTADO'} ? 'pill pill-prestado' : ''"
                                  th:if="${prestamo.estado.name() == 'PRESTADO'}">Prestado</span>
                            <span th:classappend="${prestamo.estado.name() == 'PENDIENTE_DEVOLUCION'} ? 'pill pill-pendiente' : ''"
                                  th:if="${prestamo.estado.name() == 'PENDIENTE_DEVOLUCION'}">Pendiente de aprobación</span>
                            <span th:classappend="${prestamo.estado.name() == 'DEVUELTO'} ? 'pill pill-devuelto' : ''"
                                  th:if="${prestamo.estado.name() == 'DEVUELTO'}">Devuelto</span>
                        </td>
                        <td>
                            <form th:if="${prestamo.estado.name() == 'PRESTADO'}" th:action="@{|/prestamo/${prestamo.id}/devolucion|}" method="post">
                                <button class="btn-secondary" type="submit">Solicitar devolución</button>
                            </form>
                            <span th:if="${prestamo.estado.name() == 'PENDIENTE_APROBACION'}">En revisión del administrador</span>
                            <span th:if="${prestamo.estado.name() == 'PENDIENTE_DEVOLUCION'}">Solicitud enviada</span>
                            <span th:if="${prestamo.estado.name() == 'DEVUELTO'}">-</span>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(prestamos)}">
                        <td colspan="7">Aún no registras préstamos.</td>
                    </tr>
                </tbody>
            </table>
        </body>
    </html>